<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Look</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <style>
        body { background-image:url('https://www.transparenttextures.com/patterns/wood-pattern.png'); background-color:#f5efe0; padding-top:20px; }
        .book-card { height:100%; transition:all .3s ease; border-radius:12px; overflow:hidden; border:none; box-shadow:0 5px 15px rgba(0,0,0,.08); }
        .book-card:hover { transform:translateY(-8px); box-shadow:0 15px 30px rgba(0,0,0,.15); }
        .book-img { height:180px; object-fit:contain; background-color:#f9f9f9; }
        .book-status { position:absolute; top:10px; right:10px; padding:5px 10px; border-radius:20px; font-size:.75rem; font-weight:bold; }
        .status-to-read { background-color:#ffc107; color:#212529; }
        .status-reading { background-color:#0d6efd; color:#fff; }
        .status-completed { background-color:#198754; color:#fff; }
        .suggestions-container { position:absolute; width:100%; max-height:220px; overflow-y:auto; background:#fff; border:1px solid #ddd; border-radius:0 0 8px 8px; z-index:1000; box-shadow:0 5px 10px rgba(0,0,0,.1); display:none; }
        .suggestion-item { padding:10px 15px; cursor:pointer; border-bottom:1px solid #f0f0f0; }
        .suggestion-item:hover { background:#f5f5f5; }
    </style>
</head>
<body>
<div class="container py-4">
    <h1 class="text-center mb-4" style="color:#5d4037">Book Look</h1>

    <!-- add book -->
    <div class="mb-5">
        <h4 style="color:#5d4037">Add a new book</h4>
        <form id="add-book-form" class="row g-3">
            <div class="col-md-9 position-relative">
                <input id="book-title" class="form-control" placeholder="Enter book title" required autocomplete="off" />
                <div id="book-suggestions" class="suggestions-container"></div>
            </div>
            <div class="col-md-3">
                <button class="btn btn-primary w-100" style="background:#8d6e63;border:#8d6e63" type="submit"><i class="fas fa-plus-circle me-2"></i>Add Book</button>
            </div>
        </form>
        <div id="add-book-result" class="mt-3"></div>
    </div>

    <!-- books list -->
    <div id="books-grid" class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4"></div>
    <div id="empty-state" class="text-center mt-5 p-5 bg-white rounded shadow-sm d-none">
        <i class="fas fa-book fa-3x mb-3" style="color:#8d6e63"></i>
        <h3 style="color:#5d4037">No books added yet!</h3>
        <p class="text-muted">Use the form above to add your first book.</p>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
const STORAGE_KEY = 'booklook-books-v1';
function loadBooks(){
  return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
}
function saveBooks(arr){
  localStorage.setItem(STORAGE_KEY,JSON.stringify(arr));
}
function renderBooks(){
  const grid=document.getElementById('books-grid');
  const empty=document.getElementById('empty-state');
  grid.innerHTML='';
  const books=loadBooks();
  if(!books.length){ empty.classList.remove('d-none'); return; } else empty.classList.add('d-none');
  books.forEach((b,idx)=>{
    const col=document.createElement('div'); col.className='col';
    col.innerHTML=`<div class="card book-card h-100"><div class="position-relative">${b.image?`<img src="${b.image}" class="card-img-top book-img" alt="${b.title}">`:`<div class="card-img-top book-img bg-light d-flex align-items-center justify-content-center"><span class="text-muted">No Image</span></div>`}<span class="book-status status-${b.status.toLowerCase().replace(/\s+/g,'-')}">${b.status}</span></div><div class="card-body"><h5 class="card-title">${b.title}</h5><p class="card-text"><small class="text-muted">${b.author||''}</small></p></div><div class="card-footer bg-white d-flex justify-content-between"><select class="form-select form-select-sm me-2" data-idx="${idx}"><option${b.status==='To Read'?' selected':''}>To Read</option><option${b.status==='Reading'?' selected':''}>Reading</option><option${b.status==='Completed'?' selected':''}>Completed</option></select><button class="btn btn-outline-danger btn-sm" data-del="${idx}"><i class="fas fa-trash-alt"></i></button></div></div>`;
    grid.appendChild(col);
  });
}
// update status / delete handlers
document.getElementById('books-grid').addEventListener('change',e=>{
  if(e.target.matches('select[data-idx]')){
    const books=loadBooks();
    books[e.target.dataset.idx].status=e.target.value;
    saveBooks(books); renderBooks();
  }
});
document.getElementById('books-grid').addEventListener('click',e=>{
  if(e.target.closest('button[data-del]')){
    const idx=e.target.closest('button').dataset.del;
    const books=loadBooks(); books.splice(idx,1); saveBooks(books); renderBooks();
  }
});
// suggestions
const titleInput=document.getElementById('book-title');
const suggContainer=document.getElementById('book-suggestions');
let abortCtrl;
titleInput.addEventListener('input',()=>{
  const q=titleInput.value.trim();
  if(q.length<2){suggContainer.style.display='none';suggContainer.innerHTML=''; if(abortCtrl)abortCtrl.abort(); return;}
  if(abortCtrl)abortCtrl.abort(); abortCtrl=new AbortController();
  fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(q)}&maxResults=10`,{signal:abortCtrl.signal})
  .then(r=>r.json()).then(d=>{
    suggContainer.innerHTML='';
    if(!d.items){suggContainer.style.display='none';return;}
    d.items.forEach(it=>{
      const info=it.volumeInfo;
      const div=document.createElement('div'); div.className='suggestion-item d-flex align-items-center';
      const thumb=info.imageLinks?.thumbnail;
      if(thumb){ const img=document.createElement('img'); img.src=thumb; img.width=40; img.height=60; img.className='me-2 flex-shrink-0'; div.appendChild(img); }
      const span=document.createElement('span'); span.textContent=`${info.title}${info.authors?' â€“ '+info.authors[0]:''}`; div.appendChild(span);
      div.addEventListener('click',()=>{ titleInput.value=info.title; suggContainer.style.display='none'; });
      suggContainer.appendChild(div);
    });
    suggContainer.style.display='block';
  }).catch(err=>{ if(err.name!=='AbortError')console.error(err); });
});
document.addEventListener('click',e=>{ if(!titleInput.contains(e.target)&&!suggContainer.contains(e.target))suggContainer.style.display='none'; });
// add book
document.getElementById('add-book-form').addEventListener('submit',e=>{
  e.preventDefault();
  const title=titleInput.value.trim(); if(!title)return;
  const resDiv=document.getElementById('add-book-result'); resDiv.innerHTML='<div class="alert alert-info">Fetching book info...</div>';
  fetch(`https://www.googleapis.com/books/v1/volumes?q=intitle:${encodeURIComponent(title)}&maxResults=1`).then(r=>r.json()).then(d=>{
    if(d.totalItems===0){ resDiv.innerHTML='<div class="alert alert-warning">Book not found.</div>'; return; }
    const info=d.items[0].volumeInfo;
    const newBook={ title:info.title, author:info.authors?info.authors[0]:'', image:info.imageLinks?.thumbnail||'', status:'To Read' };
    const books=loadBooks(); books.push(newBook); saveBooks(books); titleInput.value=''; resDiv.innerHTML='<div class="alert alert-success">Book added!</div>'; renderBooks();
  }).catch(()=>{ resDiv.innerHTML='<div class="alert alert-danger">Error fetching info.</div>'; });
});
// initial render
renderBooks();
</script>
</body>
</html>